## Summary / implementation

**Outcome:** CSV bulk export for analytics dashboard, from customer signal (Gong, Canny, Zendesk). Enables board reporting and reduces manual copy-paste; tied to expansion (Acme) and renewal (Beta Inc).

**Linear:** Implements SYT-17

**What changed:** Customers had no way to export analytics data from the dashboard. This adds a `POST /api/export` endpoint that accepts date range, metrics, and workspace ID and returns a CSV file. The dashboard "Export CSV" button calls this endpoint and triggers a browser download. Inputs are validated (ISO dates, metric allowlist, sanitized filename) per the spec’s security mitigation.

**Implementation notes:**
- **New:** `src/services/export-service.ts` — `buildCsv()`, `sanitizeFilename()`, `validateMetrics()`, metric allowlist
- **New:** `src/api/routes/export.ts` — `POST /api/export` with Zod validation, CSV response and headers
- **Updated:** `src/app.ts` — mount export routes
- **Updated:** `src/components/AnalyticsDashboard.tsx` — "Export CSV" button, `handleExport()`, exporting state
- **New:** `src/__tests__/export-service.test.ts` — unit tests (CSV builder, sanitizer, metric validation)
- **New:** `src/__tests__/export-route.test.ts` — integration tests (valid/invalid requests, date ranges)
- **Spec:** `specs/csv-bulk-export.md`

---

## Testing / QA checklist

- [ ] **Automated:** `npm test` passes (unit + integration for export service and route).
- [ ] **API:** `POST /api/export` with body `{ "startDate": "2026-02-01", "endDate": "2026-02-15", "metrics": ["activeUsers", "events"], "workspaceId": "demo-workspace" }` returns 200, `Content-Type: text/csv`, and CSV with header row and one row per day. Invalid body or unknown metrics → 400.
- [ ] **UI:** Open dashboard → set date range → click "Export CSV" → file downloads as `analytics-export-<start>-to-<end>.csv` with correct columns (date + selected metrics) and values. Button shows "Exporting…" and is disabled while in progress; errors appear in the error banner.
- [ ] **Acceptance criteria:** CSV contains selected metrics and date range; button disabled while export in progress; invalid metrics rejected with 400; filename uses sanitized dates.
